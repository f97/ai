# One-API Performance Optimization Configuration
# 单用户性能优化配置示例

# ============================================================
# Phase A: SQLite Optimizations (推荐首先启用)
# ============================================================

# 启用 SQLite 优化
SQLITE_OPTIMIZE_ENABLED=true

# WAL 模式 - 提高并发性能
SQLITE_JOURNAL_MODE=WAL

# 同步级别 (FULL/NORMAL/OFF)
# FULL: 最安全，最慢
# NORMAL: 推荐，平衡性能与安全 (崩溃可能丢失最近几个事务)
# OFF: 最快，风险最高 (仅测试环境)
SQLITE_SYNCHRONOUS=NORMAL

# 缓存大小 (负数 = KB, 正数 = pages)
# -64000 = 64MB cache
SQLITE_CACHE_SIZE=-64000

# 内存映射 I/O 大小 (字节)
# 256MB
SQLITE_MMAP_SIZE=268435456

# 临时表存储位置
# MEMORY: 内存中 (推荐)
# FILE: 磁盘上
SQLITE_TEMP_STORE=MEMORY

# 繁忙超时 (毫秒)
SQLITE_BUSY_TIMEOUT=5000

# 页面大小 (字节, 只在数据库创建时生效)
SQLITE_PAGE_SIZE=4096

# 自动清理模式
SQLITE_AUTO_VACUUM=INCREMENTAL

# WAL 自动检查点 (页数)
SQLITE_WAL_AUTO_CHECKPOINT=1000

# 外键约束 (单用户可以关闭以提升性能)
SQLITE_FOREIGN_KEYS=false

# SQLite 连接池设置 (小值以避免 SQLITE_BUSY)
SQLITE_MAX_OPEN_CONNS=5
SQLITE_MAX_IDLE_CONNS=2

# ============================================================
# Phase B: HTTP Client Optimizations
# ============================================================

# Keep-alive 时间 (秒)
HTTP_KEEPALIVE=90

# 最大空闲连接数
HTTP_MAX_IDLE_CONNS=100

# 每个 host 的最大空闲连接数
HTTP_MAX_IDLE_CONNS_PER_HOST=20

# 每个 host 的最大连接数
HTTP_MAX_CONNS_PER_HOST=50

# 拨号超时 (秒)
HTTP_DIAL_TIMEOUT=10

# TLS 握手超时 (秒)
HTTP_TLS_TIMEOUT=10

# 响应头超时 (秒)
HTTP_RESPONSE_HEADER_TIMEOUT=30

# 空闲连接超时 (秒)
HTTP_IDLE_CONN_TIMEOUT=90

# ============================================================
# Phase B: Async Batch Logging
# ============================================================

# 启用异步批量日志写入
# ⚠️ 崩溃可能丢失最近几秒的日志
LOG_BATCH_ENABLED=false  # 设为 true 启用

# 批量大小 (日志条数)
LOG_BATCH_SIZE=50

# 刷新间隔 (秒)
LOG_BATCH_FLUSH_INTERVAL=5

# 禁用消费日志 (更激进的优化)
# LOG_CONSUME_ENABLED=false

# ============================================================
# Phase B: Local In-Memory Cache
# ============================================================

# 启用本地内存缓存 (单用户场景推荐)
LOCAL_CACHE_ENABLED=false  # 设为 true 启用

# 缓存 TTL (秒)
LOCAL_CACHE_TTL=60

# ============================================================
# Phase B: Batch Updates (已有功能)
# ============================================================

# 启用批量更新
BATCH_UPDATE_ENABLED=true
BATCH_UPDATE_INTERVAL=5

# ============================================================
# Other Existing Settings (保持现有设置)
# ============================================================

# 内存缓存 (Redis 或内置)
MEMORY_CACHE_ENABLED=true
SYNC_FREQUENCY=600  # 10分钟

# 日志级别
# DEBUG=false

# 数据库调试
# DEBUG_SQL=false

# ============================================================
# Performance vs Safety Trade-off Summary
# ============================================================
# 
# 安全 (Safe):
#   SQLITE_SYNCHRONOUS=FULL
#   LOG_BATCH_ENABLED=false
#   LOCAL_CACHE_ENABLED=false
#   
# 平衡 (Balanced) - 推荐:
#   SQLITE_SYNCHRONOUS=NORMAL
#   LOG_BATCH_ENABLED=false
#   LOCAL_CACHE_ENABLED=true
#   
# 性能优先 (Performance):
#   SQLITE_SYNCHRONOUS=NORMAL
#   LOG_BATCH_ENABLED=true
#   LOCAL_CACHE_ENABLED=true
#   LOG_CONSUME_ENABLED=false
#   
# 极致性能 (Maximum Performance - 仅测试):
#   SQLITE_SYNCHRONOUS=OFF
#   LOG_BATCH_ENABLED=true
#   LOCAL_CACHE_ENABLED=true
#   LOG_CONSUME_ENABLED=false
#
# ============================================================
